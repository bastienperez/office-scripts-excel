{"version":"0.3.0","body":"// Script created by B.Perez\n// v1.0 - 2024-07-19 - Initial version\n// v1.1 - 2024-11-13 - Added auto-filter to header row and fix column with comma\n// v1.2 - 2024-12-06 - Fix issue with column\n\n// This script converts CSV data in each row of the active sheet into columns\n// Automatically adjusts the width of all columns in the worksheet to fit the content\n// Automatically adjusts the height of all rows in the worksheet to fit the content\n// Adds an auto-filter to the header row (assumed to be the first row)\n\nfunction main(workbook: ExcelScript.Workbook) {\n\tlet worksheet = workbook.getActiveWorksheet();\n\tlet range = worksheet.getUsedRange();\n\tlet values = range.getValues() as string[][];\n\n\tfor (let row = 0; row < values.length; row++) {\n\t\tlet csvLine = values[row][0] as string;\n\n\t\t// Parse CSV with a regex that correctly handles empty fields, quoted strings, and commas\n\t\tlet csvValues =\n\t\t\tcsvLine.match(/(?<=^|,)(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|[^,]*)/g) || [];\n\n\t\tif (csvValues.length > 1) {\n\t\t\tfor (let col = 0; col < csvValues.length; col++) {\n\t\t\t\t// Handle quoted strings and unescape double quotes\n\t\t\t\tlet cleanedValue = csvValues[col]\n\t\t\t\t\t.replace(/^\"(.*)\"$/, \"$1\") // Remove enclosing quotes\n\t\t\t\t\t.replace(/\"\"/g, '\"'); // Unescape double quotes\n\t\t\t\tworksheet.getCell(row, col).setValue(cleanedValue || \"\"); // Handle empty fields\n\t\t\t}\n\t\t}\n\t}\n\n\t// Adjust column widths and row heights\n\tworksheet.getUsedRange().getFormat().autofitColumns();\n\tworksheet.getUsedRange().getFormat().autofitRows();\n\n\t// Apply autofilter to the header row\n\tlet headerRow = worksheet.getRange(\n\t\t\"A1:\" + worksheet.getCell(0, values[0].length - 1).getAddress()\n\t);\n\tworksheet.getAutoFilter().apply(headerRow);\n}","description":"","noCodeMetadata":"","parameterInfo":"{\"version\":1,\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}},\"signature\":{\"comment\":\"\",\"parameters\":[{\"name\":\"workbook\",\"comment\":\"\"}]}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}