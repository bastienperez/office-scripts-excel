{"version":"0.3.0","body":"// Script created by B.Perez\n// v1.0 - 2024-07-19 - Initial version\n// v1.1 - 2024-11-13 - Added auto-filter to header row and fix column with comma\n\n// This script converts CSV data in each row of the active sheet into columns\n// Automatically adjusts the width of all columns in the worksheet to fit the content\n// Automatically adjusts the height of all rows in the worksheet to fit the content\n// Adds an auto-filter to the header row (assumed to be the first row)\n\nfunction main(workbook: ExcelScript.Workbook) {\n  // Get the active sheet\n  let worksheet = workbook.getActiveWorksheet();\n\n  // Get all values from the active sheet as a 2D array\n  let range = worksheet.getUsedRange();\n  let values = range.getValues() as string[][];\n\n  // Iterate through each row to convert CSV data into columns\n  for (let row = 0; row < values.length; row++) {\n    let csvLine = values[row][0] as string;\n\n    // Parse CSV using regex to handle values with commas inside quotes\n    let csvValues = csvLine.match(/(\".*?\"|[^\",\\s]+)(?=\\s*,|\\s*$)/g) || []; // Matches quoted values or unquoted values\n\n    // If the row contains CSV data\n    if (csvValues.length > 1) {\n      // Write the CSV values into the same row\n      for (let col = 0; col < csvValues.length; col++) {\n        // Remove leading and trailing quotes from each CSV value\n        let cleanedValue = csvValues[col].replace(/^\"(.*)\"$/, '$1');\n        worksheet.getCell(row, col).setValue(cleanedValue);\n      }\n    }\n  }\n\n  // Automatically adjusts the width of all columns in the worksheet to fit the content\n  worksheet.getRange(\"A:XFD\").getFormat().autofitColumns();\n\n  // Automatically adjusts the height of all rows in the worksheet to fit the content\n  worksheet.getRange(\"A:XFD\").getFormat().autofitRows();\n\n  // Define the range for the header row (assumed to be the first row) and apply an auto-filter\n  let headerRange = worksheet.getRange(\"A1:\" + worksheet.getCell(0, values[0].length - 1).getAddress());\n  worksheet.getAutoFilter().apply(headerRange);\n}","description":"","noCodeMetadata":"","parameterInfo":"{\"version\":1,\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}},\"signature\":{\"comment\":\"\",\"parameters\":[{\"name\":\"workbook\",\"comment\":\"\"}]}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}