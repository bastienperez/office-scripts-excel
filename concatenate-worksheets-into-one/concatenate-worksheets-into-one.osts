{"version":"0.3.0","body":"// Script created by B.Perez 20241023\n\nfunction main(workbook: ExcelScript.Workbook) {\n  // Get all worksheets in the workbook\n  let sheets = workbook.getWorksheets();\n\n  // Create a new worksheet for the combined data\n  let newSheet = workbook.addWorksheet(\"CombinedData\");\n\n  // Initialize a variable to track the current row for pasting data\n  let currentRow = 0;\n\n  // Get the header from the first sheet\n  let firstSheet = sheets[0];\n  let header = firstSheet.getUsedRange().getValues()[0];\n\n  // Add the \"Source\" column header to the header array\n  let updatedHeader = [...header, \"Source\"];\n\n  // Set the header in the new sheet\n  newSheet.getRangeByIndexes(currentRow, 0, 1, updatedHeader.length).setValues([updatedHeader]);\n\n  // Move to the next row after the header\n  currentRow++;\n\n  // Loop through each sheet\n  sheets.forEach((sheet, index) => {\n    // Get the used range of the current sheet\n    let usedRange = sheet.getUsedRange();\n\n    // Skip the header row for all sheets\n    let startRow = 1;\n\n    // Get the data from the used range, excluding the header\n    let data = usedRange.getValues().slice(startRow);\n\n    // Add sheet name as the last column for each row\n    let dataWithSheetName = data.map(row => {\n      row.push(sheet.getName());\n      return row;\n    });\n\n    // Paste the data into the new sheet starting at the current row\n    newSheet.getRangeByIndexes(currentRow, 0, dataWithSheetName.length, dataWithSheetName[0].length).setValues(dataWithSheetName);\n\n    // Update the current row for the next paste operation\n    currentRow += dataWithSheetName.length;\n  });\n\n  // Auto-fit columns in the new sheet\n  newSheet.getUsedRange().getFormat().autofitColumns();\n\n  // Convert the used range to a table\n  let lastUsedRange = newSheet.getUsedRange();\n  let table = newSheet.addTable(lastUsedRange, true);\n  table.setName(\"CombinedDataTable\");\n\n  // Apply default table style (e.g., \"TableStyleMedium9\")\n  table.setPredefinedTableStyle(\"TableStyleMedium2\");\n}","description":"","noCodeMetadata":"","parameterInfo":"{\"version\":1,\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}},\"signature\":{\"comment\":\"\",\"parameters\":[{\"name\":\"workbook\",\"comment\":\"\"}]}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}